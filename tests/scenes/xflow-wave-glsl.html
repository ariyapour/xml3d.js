<!doctype html>
<html lang="en">
  <head>
    <!-- Style -->
    <link rel="stylesheet" type="text/css" media="all" href="style/page.css"/>
    <link rel="stylesheet" type="text/css" media="all" href="style/jquery-ui.css"/>
    <!-- Scripts -->
    <script type="text/javascript" src="../../build/output/xml3d.js"></script>
<!-- <<<<<<< HEAD -->
    <script type="text/javascript" src="../../../shadejs/shade.js"></script>
    <script type="text/javascript" src="../../tools/camera.js"></script>
    <script type="text/javascript" src="scripts/myxflow-shadejs.js" ></script>
    <script type="text/javascript" src="scripts/fetchTex.js" ></script>
    <script type="text/javascript" src="scripts/starBall.js" ></script>
    <script type="text/javascript" src="scripts/fractal.js" ></script>
    <script type="text/javascript" src="scripts/checker.js" ></script>
    <script type="text/javascript" src="scripts/voronoiNoise.js" ></script>
    <script type="text/javascript" src="scripts/calcDistance.js" ></script>
    <script type="text/javascript" src="scripts/randomPointGenerator.js" ></script>
    <script type="text/javascript" src="scripts/snoise.js" ></script>
    <script type="text/javascript" src="scripts/colorMul.js" ></script>
    <script type="text/javascript" src="scripts/colorRamp.js" ></script>
    <script type="text/javascript" src="scripts/clampLength.js" ></script>
<!-- =======
    <script type="text/javascript" src="../../../shadejs/lib/shade.js"></script>
    <script type="text/javascript" src="../../tools/camera.js"></script>
    <script type="text/javascript" src="scripts/myxflow-shadejs.js" ></script>
>>>>>>> ariyapour/xflow-shadejs
    <title>XML3D Examples</title> -->

  </head>
  <body>
  <div id="overall"><div id="content">
   <h1>
    Wave it!
   </h1>
<!--<<<<<<< HEAD -->


	<script id="shader" type="text/shade-javascript" >
    function shade(env) {
        return new Shade().diffuse(env.diffuseColor,env.normal,env.ambientIntensity);
    }
   </script>

    <xml3d id="myxml3d" class="xml3d" activeView="#Camera" style="background: white;" >
<!-- =======
   <script id="shader" type="text/shade-javascript" >
        function shade(env) {
            var color = env.diffuseColor;
            if(env.diffuseTexture && env.texcoord){
                var texColor = env.diffuseTexture.sample2D(env.texcoord).rgb();
                texColor = Math.pow(texColor, new Vec3(2.2));
                color = color.mul(texColor);
            }
            //return color;
            return new Shade().diffuse(color, env.normal, 1)
                    .phong(env.specularColor, env.normal, env.shininess);
        }
   </script>

    <xml3d id="myxml3d" class="xml3d" activeView="#Camera" style="background: black;" >
>>>>>>> ariyapour/xflow-shadejs -->
     <defs id="mainDef">

      <!--- Not so important part: -->

      <lightshader id="ls_Spot" script="urn:xml3d:lightshader:point">
       <float3 name="attenuation">1 0.033333 1</float3>
       <float3 name="intensity">100 100 100</float3>
      </lightshader>
<!--<<<<<<< HEAD -->
	 
	 
	  <!--  ColorRamp and Texture -->
	    <!--   
	  <data id="color" compute="(diffuseColor)=xflow.fetchTex(diffuseTexture,texcoord)">
			<float2 name="texcoord" deferred=true></float2>
		    <texture name="diffuseTexture"><img src="textures/water.jpg"/></texture>
	  </data>  
	  
	  <data id="color2" compute="(fac)=xflow.clampLength(diffuseColor)">
	  		<data src="#color"></data>
	  </data>
	      
	  <data id="color3" compute="(diffuseColor)=xflow.colorRamp(fac,color1,color2)">
	  		  <data src="#color2"></data>
	  		  <float3 name="color1" >0.018 0.005 0.310</float3>
  			  <float3 name="color2" >0.056 0.828 0.096</float3>
	  </data>    
	      -->
	      
	      
	  <!--  ColorRamp and Checker -->
	  <!--
	  <data id="color" compute="(diffuseColor)=xflow.checker(texcoord,frequency)">
			<float2 name="texcoord" deferred=true></float2>
			<float name="frequency">10</float>
	  </data> 
	  
	  <data id="color2" compute="(fac)=xflow.clampLength(diffuseColor)">
	  		<data src="#color"></data>
	  </data>
	      
	  <data id="color3" compute="(diffuseColor)=xflow.colorRamp(fac,color1,color2)">
	  		  <data src="#color2"></data>
	  		  <float3 name="color1" >0.0 0.0 0.0</float3>
  			  <float3 name="color2" >1.0 0.0 0.096</float3>
	  </data>    
	  -->

	            
	  <!--  ColorRamp and StarBall -->
	  <!--
	  <data id="color" compute="(diffuseColor)=xflow.starBall(position,texcoord)">
	  		<float3 name="position" deferred=true></float3>
			<float2 name="texcoord" deferred=true></float2>
	  </data>
	  
	  <data id="color2" compute="(fac)=xflow.clampLength(diffuseColor)">
	  		<data src="#color"></data>
	  </data>
	      
	  <data id="color3" compute="(diffuseColor)=xflow.colorRamp(fac,color1,color2)">
	  		  <data src="#color2"></data>
 			  <float3 name="color1" >0.0 0.0 1.0</float3>
  			  <float3 name="color2" >0.056 0.828 0.096</float3>
	  </data>    
	  -->
	  
	  <!-- Texture and ColorMul -->
	 <!--
	  <data id="color" compute="(diffuseColor)=xflow.fetchTex(diffuseTexture,texcoord)">
			<float2 name="texcoord" deferred=true></float2>
		    <texture name="diffuseTexture" deferred=true><img src="textures/water.jpg"/></texture>
	  </data>
	  
	  <data id="color2" compute="(diffuseColor)=xflow.colorMul(diffuseColor,scale)">
	  		<float name="scale">5</float>
	  <data src="#color"></data>
	  </data>
	  -->
	  
	  
	  <!-- StarBall and ColorMul -->
	  <!--
	  <data id="color" compute="(diffuseColor)=xflow.starBall(position,texcoord)">
	  		<float3 name="position" deferred=true></float3>
			<float2 name="texcoord" deferred=true></float2>
	  </data>
	  
	  <data id="color2" compute="(diffuseColor)=xflow.colorMul(diffuseColor,scale)">
	  		<float name="scale">10</float>
	  		<data src="#color"></data>
	  </data>
	  
	  -->
	  
	  
	  <!-- Checker -->
	   <!--
	  <data id="color" compute="(diffuseColor)=xflow.checker(texcoord,frequency)">
			<float2 name="texcoord" deferred=true></float2>
			<float name="frequency">10</float>
	  </data>
	  
	  
	  <!-- Fractal -->
	  <!--
	  <data id="color" compute="(diffuseColor)=xflow.fractal(texcoord,time)">
			<float2 name="texcoord" deferred=true></float2>
			<float name="time">0.0</float>
	  </data>
	  -->
	  
	  <!-- Texture -->
	  
      <data id="color" compute="(diffuseColor)=xflow.fetchTex(diffuseTexture,texcoord)">
			<float2 name="texcoord" deferred=true></float2>
		    <texture name="diffuseTexture" deferred=true><img src="textures/water.jpg"/></texture>
	  </data>
	  -->
	  
      <shader id="Material" script="#shader">
	     <float name="ambientIntensity">0.1</float> 
    	 <data src="#color"></data>
      </shader>  
<!--=======

      <shader id="Material" script="#shader" >
       <float name="ambientIntensity">0.1</float>
       <texture name="diffuseTexture"><img src="textures/water.jpg"/></texture>
       <float3 name="diffuseColor">1 1 1</float3>
       <float3 name="specularColor">0.5 0.5 0.5</float3>
       <float name="shininess">0.0978473581213</float>
      </shader>
>>>>>>> ariyapour/xflow-shadejs -->

      <transform id="t_Camera" rotation="-0.641815 0.733700 0.223063 1.145952" scale="1 1 1" translation="3.184399 3.711076 2.405665"></transform>
      <transform id="t_Grid" rotation="1 0.000000 0.000000 0.000000" scale="25.000000 25.000000 25.000000" translation="0.000000 0.00 0.000000"></transform>
      <transform id="t_Lamp" rotation="0.205942 0.331517 0.920698 1.926274" scale="1 1 1" translation="2.086632 10.648042 1.161145"></transform>

<!--<<<<<<< HEAD -->
      <!-- Generate Grid: -->
      
<!--=======-->
      <!-- Example Data: -->
<!--
      <data id="exampleGrid" >
        <float3 name="position">-1 0 -1  -1 0 0  -1 0 1    0 0 -1  0 0 0  0 0 1    1 0 -1  1 0 0  1 0 1</float3>
        <float3 name="normal">0 1 0  0 1 0  0 1 0    0 1 0  0 1 0  0 1 0    0 1 0  0 1 0  0 1 0</float3>
        <float2 name="texcoord">0 0  0 0.5  0 1    0.5 0  0.5 0.5  0.5 1    1 0  1 0.5  1 1</float2>
        <int name="index">0 1 3  1 3 4    1 2 4  2 4 5    3 4 6  4 6 7    4 5 7  5 7 8 </int>
      </data>-->

      <!-- Generate Grid: -->
<!-->>>>>>> ariyapour/xflow-shadejs -->

      <data id="generatedGrid" compute="xflow.mygrid(size)">
		    <int name="size" id="size">200</int>
	    </data>

      <!-- Transform Grid to Waves: -->

      <data id="wave" compute="(position, normal) = xflow.mywave(position, normal, strength, wavelength, phase)" >
        <float name="strength" id="strength">0.01</float>
        <float name="wavelength" id="wavelength">40.0</float>
        <float name="phase" id="ph">0.0</float>
        <data src="#generatedGrid"></data>
      </data>

     </defs>

     <view id="Camera" orientation="-0.3941052556037903 0.9096987843513489 0.13087835907936096 0.8260897732744243" position="13.423173904418945 6.755307197570801 14.065818786621094"></view>

     <!-- Wave Shape Display: -->

     <group shader="#Material" transform="#t_Grid">
      <mesh type="triangles" id="waveMesh">
        <data src="#wave"></data>
      </mesh>
     </group>

     <!-- Light Source: -->
     <group transform="#t_Lamp">
		<light shader="#ls_Spot"></light>
     </group>

    </xml3d>

    <script type="text/javascript">
    /* Run timer for wave animation */
    var mytime = 0;
    var lastTime = Date.now();
    var myupdate = function() {
      var phase = document.getElementById("ph")
      if (phase && phase._configured) {
        phase.textContent = ""+mytime;
      }
      var diff = Date.now() - lastTime;
      lastTime = Date.now();
      mytime += diff / 500;
    }
    window.setInterval(myupdate, 20);

    document.querySelector("#waveMesh").addEventListener('xml3dsystem', function(){
        console.log("XML3D SYSTEM: " + event.detail.systemtype);
        console.log(event.detail);
    })
  </script>

   </div></div>
  </body>
 </html>
